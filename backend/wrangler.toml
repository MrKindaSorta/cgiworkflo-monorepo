#:schema node_modules/wrangler/config-schema.json
name = "cgiworkflo-api"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Workers configuration
workers_dev = true
account_id = "ce115cacc8399727e03f87e6604f9d6c"

# Environment variables (non-sensitive)
[vars]
ENVIRONMENT = "production"
API_VERSION = "v1"
CORS_ORIGINS = "https://cgiworkflo.com,https://www.cgiworkflo.com"
MAX_UPLOAD_SIZE_MB = "10"
RATE_LIMIT_REQUESTS = "100"
RATE_LIMIT_WINDOW_SECONDS = "60"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "cgiworkflo-db-production"
database_id = "034f013a-4a63-4e25-aa4b-67ff992d8881"

# R2 Bucket binding for photos
# To create: wrangler r2 bucket create cgiworkflo-photos-production
[[r2_buckets]]
binding = "PHOTOS"
bucket_name = "cgiworkflo-photos-production"

# KV Namespace for caching and rate limiting
[[kv_namespaces]]
binding = "CACHE"
id = "f39f8dd9ff7b4290826ad1d02ad36432"
preview_id = "3d9b48b2041648e39e40820e12eb6797"

# Durable Objects for WebSocket chat rooms
[[durable_objects.bindings]]
name = "CHAT_ROOMS"
class_name = "ChatRoomDO"
script_name = "cgiworkflo-api"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["ChatRoomDO"]

# Secrets (set via `wrangler secret put <KEY>`)
# Required secrets:
#   - JWT_SECRET (generate with: openssl rand -base64 32)
# Set with: wrangler secret put JWT_SECRET

# Development environment
[env.development]
name = "cgiworkflo-api-dev"
vars = { ENVIRONMENT = "development", CORS_ORIGINS = "http://localhost:3000" }

[[env.development.d1_databases]]
binding = "DB"
database_name = "cgiworkflo-db-development"
database_id = "4ac2fe5e-4ed8-44cd-91c3-bc9e154a6585"

[[env.development.r2_buckets]]
binding = "PHOTOS"
bucket_name = "cgiworkflo-photos-development"

[[env.development.kv_namespaces]]
binding = "CACHE"
id = "3d9b48b2041648e39e40820e12eb6797"

[[env.development.durable_objects.bindings]]
name = "CHAT_ROOMS"
class_name = "ChatRoomDO"
script_name = "cgiworkflo-api-dev"

# Staging environment
[env.staging]
name = "cgiworkflo-api-staging"
vars = { ENVIRONMENT = "staging", CORS_ORIGINS = "https://staging.cgiworkflo.com" }

[[env.staging.d1_databases]]
binding = "DB"
database_name = "cgiworkflo-db-staging"
database_id = "REPLACE_WITH_YOUR_STAGING_D1_DATABASE_ID"

# Build configuration
[build]
command = "npm run build"

# Observability
[observability]
enabled = true
head_sampling_rate = 1
